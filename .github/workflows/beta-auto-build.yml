name: Beta Auto Build

on:
  push:
    branches:
      - beta

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Extract Version
        run: |
          VERSION=$(cat "resources/universal-mod/version/mod-version.txt" | tr -d ' \n')
          echo "VERSION=$VERSION" >> $GITHUB_ENV

      - name: Extract Commit Hash
        run: |
          COMMIT_HASH=$(grep -oE '[0-9a-f]{7,}' "resources/universal-mod/res-texts/texts-eng_res/string version_name" | head -n 1)
          echo "COMMIT_HASH=$COMMIT_HASH" >> $GITHUB_ENV

      - name: Create ZIP Archive
        run: |
          ZIP_NAME="Universal-Mod-${VERSION}-beta-${COMMIT_HASH}.zip"
          zip -r $ZIP_NAME Universal-Mod
          echo "ZIP_NAME=$ZIP_NAME" >> $GITHUB_ENV

      - name: Create GitHub Pre-Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: beta-${VERSION}-${COMMIT_HASH}
          name: "Beta ${VERSION} (${COMMIT_HASH})"
          body: "This is an automated beta release of Universal Mod.\n\nVersion: ${VERSION}\nCommit: ${COMMIT_HASH}"
          prerelease: true
          files: ${{ env.ZIP_NAME }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
